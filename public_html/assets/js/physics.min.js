!function(){var i=this;i.Physics;common=function(){var i={},t=Array.prototype,s=Object.prototype,e=s.hasOwnProperty,n=t.slice,r=t.forEach,o=t.indexOf,h=s.toString,a=function(t,s,e){if(null!=t)if(r&&t.forEach===r)t.forEach(s,e);else if(t.length===+t.length){for(var n=0,o=t.length;n<o;n++)if(n in t&&s.call(e,t[n],n,t)===i)return}else for(var h in t)if(_.has(t,h)&&s.call(e,t[h],h,t)===i)return},c=function(i){return i},l=function(i,t,s){s||(s=c);for(var e=0,n=i.length;e<n;){var r=e+n>>1;s(i[r])<s(t)?e=r+1:n=r}return e};return{has:function(i,t){return e.call(i,t)},each:a,extend:function(i){return a(n.call(arguments,1),function(t){for(var s in t)i[s]=t[s]}),i},indexOf:function(i,t,s){if(null==i)return-1;var e,n;if(s)return e=l(i,t),i[e]===t?e:-1;if(o&&i.indexOf===o)return i.indexOf(t);for(e=0,n=i.length;e<n;e++)if(e in i&&i[e]===t)return e;return-1},sortedIndex:l,identity:c,isNumber:function(i){return"[object Number]"==h.call(i)},isFunction:function(i){return"[object Function]"==h.call(i)||"function"==typeof i},isUndefined:function(i){return void 0===i},isNull:function(i){return null===i}}}(),Vector=function(i){var t=function(i,t){this.x=i||0,this.y=t||0};return common.extend(t.prototype,{set:function(i,t){return this.x=i,this.y=t,this},copy:function(i){return this.x=i.x,this.y=i.y,this},clear:function(){return this.x=0,this.y=0,this},clone:function(){return new t(this.x,this.y)},add:function(i,t){return this.x=i.x+t.x,this.y=i.y+t.y,this},addSelf:function(i){return this.x+=i.x,this.y+=i.y,this},sub:function(i,t){return this.x=i.x-t.x,this.y=i.y-t.y,this},subSelf:function(i){return this.x-=i.x,this.y-=i.y,this},multiplySelf:function(i){return this.x*=i.x,this.y*=i.y,this},multiplyScalar:function(i){return this.x*=i,this.y*=i,this},divideScalar:function(i){return i?(this.x/=i,this.y/=i):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(i){return this.x*i.x+this.y*i.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(i){return Math.sqrt(this.distanceToSquared(i))},distanceToSquared:function(i){var t=this.x-i.x,s=this.y-i.y;return t*t+s*s},setLength:function(i){return this.normalize().multiplyScalar(i)},equals:function(i){return this.distanceTo(i)<1e-4},lerp:function(i,t){var s=(i.x-this.x)*t+this.x,e=(i.y-this.y)*t+this.y;return this.set(s,e)},isZero:function(){return this.length()<1e-4}}),t}(),i.Physics=Physics=function(i,t,s){function e(){t(e);for(var i=0;i<n.length;i++){var s=n[i];s.playing&&s.update()}}var n=[],r=function(){this.playing=!1,i.apply(this,arguments),this.animations=[],this.equilibriumCallbacks=[],n.push(this)};return s.extend(r,i,{superclass:i}),s.extend(r.prototype,i.prototype,{play:function(){return this.playing?this:(this.playing=!0,this.__equilibrium=!1,this)},pause:function(){return this.playing=!1,this},toggle:function(){return this.playing?this.pause():this.play(),this},onUpdate:function(i){return s.indexOf(this.animations,i)>=0||!s.isFunction(i)?this:(this.animations.push(i),this)},onEquilibrium:function(i){return s.indexOf(this.equilibriumCallbacks,i)>=0||!s.isFunction(i)?this:(this.equilibriumCallbacks.push(i),this)},update:function(){if(this.__optimized&&this.__equilibrium)return this;var i;for(this.tick(),i=0;i<this.animations.length;i++)this.animations[i]();if(this.__optimized&&this.__equilibrium)for(i=0;i<this.equilibriumCallbacks.length;i++)this.equilibriumCallbacks[i]();return this}}),e(),r}(ParticleSystem=function(i,t,s,e,n,r){var o=function(){this.__equilibriumCriteria={particles:!0,springs:!0,attractions:!0},this.__equilibrium=!1,this.__optimized=!1,this.particles=[],this.springs=[],this.attractions=[],this.forces=[],this.integrator=new n(this),this.hasDeadParticles=!1;var t=arguments.length;1===t?(this.gravity=new i(0,arguments[0]),this.drag=o.DEFAULT_DRAG):2===t?(this.gravity=new i(0,arguments[0]),this.drag=arguments[1]):3===t?(this.gravity=new i(arguments[0],arguments[1]),this.drag=arguments[3]):(this.gravity=new i(0,o.DEFAULT_GRAVITY),this.drag=o.DEFAULT_DRAG)};return r.extend(o,{DEFAULT_GRAVITY:0,DEFAULT_DRAG:.001,Attraction:e,Integrator:n,Particle:t,Spring:s,Vector:i}),r.extend(o.prototype,{optimize:function(i){return this.__optimized=!!i,this},setGravity:function(i,t){return this.gravity.set(i,t),this},setEquilibriumCriteria:function(i,t,s){this.__equilibriumCriteria.particles=!!i,this.__equilibriumCriteria.springs=!!t,this.__equilibriumCriteria.attractions=!!s},tick:function(){return this.integrator.step(0===arguments.length?1:arguments[0]),this.__optimized&&(this.__equilibrium=!this.needsUpdate()),this},needsUpdate:function(){var i=0;if(this.__equilibriumCriteria.particles)for(i=0,l=this.particles.length;i<l;i++)if(!this.particles[i].resting())return!0;if(this.__equilibriumCriteria.springs)for(i=0,l=this.springs.length;i<l;i++)if(!this.springs[i].resting())return!0;if(this.__equilibriumCriteria.attractions)for(i=0,l=this.attractions.length;i<l;i++)if(!this.attractions[i].resting())return!0;return!1},addParticle:function(i){return this.particles.push(i),this},addSpring:function(i){return this.springs.push(i),this},addAttraction:function(i){return this.attractions.push(i),this},makeParticle:function(i,s,e){var n=r.isNumber(i)?i:1,s=s||0,e=e||0,o=new t(n);return o.position.set(s,e),this.addParticle(o),o},makeSpring:function(i,t,e,n,r){var o=new s(i,t,e,n,r);return this.addSpring(o),o},makeAttraction:function(i,t,s,n){var r=new e(i,t,s,n);return this.addAttraction(r),r},clear:function(){this.particles.length=0,this.springs.length=0,this.attractions.length=0},applyForces:function(){var t,s;if(!this.gravity.isZero())for(t=0;t<this.particles.length;t++)this.particles[t].force.addSelf(this.gravity);var e=new i;for(t=0;t<this.particles.length;t++)s=this.particles[t],e.set(-1*s.velocity.x*this.drag,-1*s.velocity.y*this.drag),s.force.addSelf(e);for(t=0;t<this.springs.length;t++)this.springs[t].update();for(t=0;t<this.attractions.length;t++)this.attractions[t].update();for(t=0;t<this.forces.length;t++)this.forces[t].update();return this},clearForces:function(){for(var i=0;i<this.particles.length;i++)this.particles[i].clear();return this}}),o}(Vector,Particle=function(i,t){var s=function(t){this.position=new i,this.velocity=new i,this.force=new i,this.mass=t,this.fixed=!1,this.age=0,this.dead=!1};return common.extend(s.prototype,{distanceTo:function(i){return this.position.distanceTo(i.position)},makeFixed:function(){return this.fixed=!0,this.velocity.clear(),this},reset:function(){return this.age=0,this.dead=!1,this.position.clear(),this.velocity.clear(),this.force.clear(),this.mass=1,this},resting:function(){return this.fixed||this.velocity.isZero()&&this.force.isZero()}}),s}(Vector),Spring=function(i,t){var s=function(i,t,s,e,n){this.constant=s,this.damping=e,this.length=n,this.a=i,this.b=t,this.on=!0};return common.extend(s.prototype,{currentLength:function(){return this.a.position.distanceTo(this.b.position)},update:function(){var t=this.a,s=this.b;if(!this.on||t.fixed&&s.fixed)return this;var e=(new i).sub(t.position,s.position),n=e.length();0===n?e.clear():e.divideScalar(n);var r=-1*(n-this.length)*this.constant,o=(new i).sub(t.velocity,s.velocity),h=r+-1*this.damping*o.dot(e);return e.multiplyScalar(h),t.fixed||t.force.addSelf(e),s.fixed||s.force.subSelf(e),this},resting:function(){var i=this.a,t=this.b,s=this.length;return!this.on||i.fixed&&t.fixed||i.fixed&&(0===s?t.position.equals(i.position):t.position.distanceTo(i.position)<=s)&&t.resting()||t.fixed&&(0===s?i.position.equals(t.position):i.position.distanceTo(t.position)<=s)&&i.resting()}}),s}(Vector),Attraction=function(i,t){var s=function(i,t,s,e){this.a=i,this.b=t,this.constant=s,this.on=!0,this.distanceMin=e,this.distanceMinSquared=e*e};return common.extend(s.prototype,{update:function(){var t=this.a,s=this.b;if(!(!this.on||t.fixed&&s.fixed)){t.position.x,s.position.x,t.position.y,s.position.y;var e=(new i).sub(t.position,s.position),n=Math.max(e.lengthSquared(),this.distanceMinSquared),r=this.constant*t.mass*s.mass/n,o=Math.sqrt(n);return 0===r||0===o?e.clear():e.divideScalar(o).multiplyScalar(r),t.fixed||t.force.subSelf(e),s.fixed||s.force.addSelf(e),this}},resting:function(){var i=this.a,t=this.b,s=this.distanceMin;return!this.on||i.fixed&&t.fixed||i.fixed&&t.position.distanceTo(i.position)<=s&&t.resting()||t.fixed&&i.position.distanceTo(t.position)<=s&&i.resting()}}),s}(Vector),Integrator=function(i,t){var s=function(i){this.s=i,this.originalPositions=[],this.originalVelocities=[],this.k1Forces=[],this.k1Velocities=[],this.k2Forces=[],this.k2Velocities=[],this.k3Forces=[],this.k3Velocities=[],this.k4Forces=[],this.k4Velocities=[]};return common.extend(s.prototype,{allocateParticles:function(){for(;this.s.particles.length>this.originalPositions.length;)this.originalPositions.push(new i),this.originalVelocities.push(new i),this.k1Forces.push(new i),this.k1Velocities.push(new i),this.k2Forces.push(new i),this.k2Velocities.push(new i),this.k3Forces.push(new i),this.k3Velocities.push(new i),this.k4Forces.push(new i),this.k4Velocities.push(new i);return this},step:function(i){var t,s,e,n,r,o,h,a,c,l,u,f,p,d,y=this.s;for(this.allocateParticles(),n=0;n<y.particles.length;n++)(t=y.particles[n]).fixed||(this.originalPositions[n].copy(t.position),this.originalVelocities[n].copy(t.velocity)),t.force.clear();for(y.applyForces(),n=0;n<y.particles.length;n++)(t=y.particles[n]).fixed||(this.k1Forces[n].copy(t.force),this.k1Velocities[n].copy(t.velocity)),t.force.clear();for(n=0;n<y.particles.length;n++)(t=y.particles[n]).fixed||(r=this.originalPositions[n],o=this.k1Velocities[n],s=r.x+.5*o.x*i,e=r.y+.5*o.y*i,t.position.set(s,e),l=this.originalVelocities[n],u=this.k1Forces[n],s=l.x+.5*u.x*i/t.mass,e=l.y+.5*u.y*i/t.mass,t.velocity.set(s,e));for(y.applyForces(),n=0;n<y.particles.length;n++)(t=y.particles[n]).fixed||(this.k2Forces[n].copy(t.force),this.k2Velocities[n].copy(t.velocity)),t.force.clear();for(n=0;n<y.particles.length;n++)(t=y.particles[n]).fixed||(r=this.originalPositions[n],h=this.k2Velocities[n],t.position.set(r.x+.5*h.x*i,r.y+.5*h.y*i),l=this.originalVelocities[n],f=this.k2Forces[n],t.velocity.set(l.x+.5*f.x*i/t.mass,l.y+.5*f.y*i/t.mass));for(y.applyForces(),n=0;n<y.particles.length;n++)(t=y.particles[n]).fixed||(this.k3Forces[n].copy(t.force),this.k3Velocities[n].copy(t.velocity)),t.force.clear();for(n=0;n<y.particles.length;n++)(t=y.particles[n]).fixed||(r=this.originalPositions[n],a=this.k3Velocities[n],t.position.set(r.x+a.x*i,r.y+a.y*i),l=this.originalVelocities[n],p=this.k3Forces[n],t.velocity.set(l.x+p.x*i/t.mass,l.y+p.y*i/t.mass));for(y.applyForces(),n=0;n<y.particles.length;n++)(t=y.particles[n]).fixed||(this.k4Forces[n].copy(t.force),this.k4Velocities[n].copy(t.velocity));for(n=0;n<y.particles.length;n++)(t=y.particles[n]).age+=i,t.fixed||(r=this.originalPositions[n],o=this.k1Velocities[n],h=this.k2Velocities[n],a=this.k3Velocities[n],c=this.k4Velocities[n],s=r.x+i/6*(o.x+2*h.x+2*a.x+c.x),e=r.y+i/6*(o.y+2*h.y+2*a.y+c.y),t.position.set(s,e),l=this.originalVelocities[n],u=this.k1Forces[n],f=this.k2Forces[n],p=this.k3Forces[n],d=this.k4Forces[n],s=l.x+i/(6*t.mass)*(u.x+2*f.x+2*p.x+d.x),e=l.y+i/(6*t.mass)*(u.y+2*f.y+2*p.y+d.y),t.velocity.set(s,e));return this}}),s}(Vector),common),requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(i){window.setTimeout(i,1e3/60)},common)}();